@using System.Data
@using System.Data.Entity
@using System.Text
@using System.Web.Script.Serialization
@using System.Xml
@using AplicacionBase.Models.ViewModels
@{
    ViewBag.Title = "Vista previa de reporte";
    List<ItemReportViewModel> items = ViewBag.Items;
    int id = 0;
    int t = 0;
}
<div>
<div class="c12 first">
    
    <h2>Vista previa Reporte</h2>
    <div class="c2"></div>
    <div class="c8" style="border: black 1px">
        <p align="right">
            Fecha: @ViewBag.ReportDate
        </p>
        <p align="justify">
            @ViewBag.ReportName
        </p>
        <br/>
        <hr/>
        @foreach (var item in items)
        {
            <div>
                
                @{
                    if (item.Type)
                    {
                        @: <h3>Pregunta:</h3>
                        @: <p align="justify">@item.Sentence</p>                  
                    }

                    string container = "chartContainer" + id;
                    string chart = "chart" + id;
                    string chartrender = chart + ".render();";
                    DataTable dt = item.Table;
                    <table style="border: 1px solid black">
                        <thead>
                            <tr>
                                @foreach (DataColumn column in dt.Columns)
                                {
                                    <th>@column.Caption</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (DataRow row in dt.Rows)
                            {
                                if (t%2 == 0)
                                {
                                    @:<tr>
                                }
                                else
                                {
                                    @:<tr class="even">
                                }
                                
                                foreach (var cell in row.ItemArray)
                                {
                                    <td>@cell.ToString()</td>
                                }
                                @:</tr>
                                t++;
                            }
                        </tbody>
                    </table>

                    
                    <div id="@container" style="height: 300px; width: 100%;">
                    </div>
                    id++;
                }
                
            
            </div>
            <div>
                <p>Total: @item.DataNumber </p>
                <p align="center">Pagina @id</p>
            </div>
            <br/>
            <hr/>
            <br/>
            
            //id++;
        }
    </div>
    <div class="c2"></div>
</div>
&nbsp;
</div>
    <script type="text/javascript">
        window.onload = function() {
        @{
          id = 0;
        }
            @foreach (var item2 in items)
        {
            string container = "chartContainer" + id;
            string chart = "chart" + id;
            string chartrender = chart + ".render();";
            string question = item2.Sentence.Normalize(NormalizationForm.FormC);
            string grafico = item2.GraphicType;
            string tipo = "";
            int j = 10;
            tipo = grafico == "Pastel" ? "pie" : "bar";
            foreach (var val in item2.DataList)
            {
            }
            <text>var @chart = new CanvasJS.Chart("@container",         
                {
                    title: {
                        text: "@question",
                    },
                    data: [
                        {
                            type: "@tipo",

                            showInLegend: true,
                            dataPoints: [
                                @foreach (KeyValuePair<string, int> key in item2.DataList.First())
                                {
                                    var value = key.Value;
                                    var sentence = key.Key;
                                    if (grafico == "Pastel")
                                    {
                                        <text>{  y: @value, legendText:"@sentence", indexLabel: "@sentence" },</text>
                                    }
                                    else
                                    {
                                        <text>{ y: @value, label: "@sentence"},</text>
                                    }
                                    j += 10;

                                }                            
                            ]
                        }
                    ]
                });

            @chartrender</text>
            id++;
        }
        }
    </script>



<script type="text/javascript" src="@Url.Content("~/Scripts/canvasjs.min.js")"></script>
